<%- include('partials/header') %>
<main>
  <div class="container">
    <div class="row">
      <section class="col-md-9">
        <h2>Safari Zone</h2>
        <div class="container text-center mt-3">
          <p class="lead">
            Klik op de Pokéball en probeer jouw eigen Pokémon te vangen! Wie
            weet welke zeldzame Pokémon je tegenkomt?
          </p>
        </div>
        <div class="container img-fluid">
          <div class="row justify-content-center">
            <div class="col-md-6">
              <div class="card pokedex-card">
                <div class="pokedex-header text-center">
                  <h5>#<%= randomPokemon.id %> <%= randomPokemon.name %></h5>
                </div>
                <div class="pokedex-body">
                  <img
                    src="<%= randomPokemon.sprites.front_default %>"
                    class="card-img-top"
                    alt="<%= randomPokemon.name %>"
                  />
                  <div class="card-body text-center">
                    <h5 class="card-title">Stats</h5>
                    <div class="row">
                      <!-- Voeg een rij toe voor de stats -->
                      <% if (randomPokemon && randomPokemon.stats &&
                      randomPokemon.stats.length > 0) { %>
                      <div class="col-6 col-md-4">
                        Levens Punten <%= randomPokemon.stats[0].base_stat %>
                      </div>
                      <div class="col-6 col-md-4">
                        Aanval <%= randomPokemon.stats[1].base_stat %>
                      </div>
                      <div class="col-6 col-md-4">
                        Verdediging <%= randomPokemon.stats[2].base_stat %>
                      <% } else { %>
                      <div class="col-12">
                        No stats available for this Pokémon.
                      </div>
                      <% } %>
                    </div>
                  </div>
                  <div class="d-flex justify-content-center">
                    <button
                      id="pokeball-btn"
                      type="button"
                      class="btn-pokeball"
                      style="background-color: transparent; border: none"
                    >
                      <img
                        src="../../assets/images/poke-ball.png"
                        alt="Pokeball"
                        style="width: 100px; height: 100px"
                      />
                    </button>
                  </div>
                  <p id="catch-result"></p>
                  <p id="attempts-left"></p>
                  <button
                    id="reset-btn"
                    type="button"
                    class="btn btn-primary"
                    style="display: none"
                  >
                    Opnieuw proberen
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <%- include('partials/aside') %>
    </div>
  </div>
</main>

<script>
  let attempts = 3;

  document
    .getElementById("pokeball-btn")
    .addEventListener("click", function () {
      if (attempts > 0) {
        const catchRate = 0.25; // Chance to catch the Pokémon
        const random = Math.random(); // Generate a random number

        if (random < catchRate) {
          document.getElementById("catch-result").textContent =
            "You caught the Pokémon!";
          document.getElementById("catch-result").style.color = "green";
          document.getElementById("pokeball-btn").disabled = true; // Disable the button after catching
          document.getElementById("reset-btn").style.display = "block"; // Show the reset button
        } else {
          attempts--;
          document.getElementById("catch-result").textContent =
            "The Pokémon escaped! Try again.";
          document.getElementById("catch-result").style.color = "red";
          document.getElementById("attempts-left").textContent =
            "Attempts left: " + attempts;

          if (attempts === 0) {
            document.getElementById("pokeball-btn").disabled = true; // Disable the button if no attempts left
            document.getElementById("reset-btn").style.display = "block"; // Show the reset button
          }
        }
      }
    });

  document.getElementById("reset-btn").addEventListener("click", function () {
    location.href = "/catcher"; // Reloads the page or redirects to the initial route to fetch a new Pokémon
  });
</script>
<%- include('partials/footer') %>
